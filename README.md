# MedRegistry

**MedRegistry** - это веб-приложение для управления нарко-диспансерами, автоматизирующее процессы размещения и выписки пациентов. Приложение предоставляет возможности для администраторов и главных врачей в управлении нарко-диспансерами, комнатами и койками.

## Описание

Проект **MedRegistry** предоставляет следующие возможности:
- **Управление нарко-диспансерами**:
  - Создание, просмотр, редактирование и удаление нарко-диспансеров.
- **Управление комнатами**:
  - Создание, просмотр, редактирование и удаление комнат в нарко-диспансерах.
- **Управление койками**:
  - Создание, просмотр, редактирование и удаление коек в комнатах.
- **Процесс заселения (Check-in)**:
  - Заселение пациентов в свободные койки.
  - Просмотр и изменение данных о пациентах.
- **Процесс выписки (Check-out)**:
  - Выписка пациентов из коек.
  - Генерация и сохранение справок для пациентов.
- **Управление пользователями**:
  - Назначение ролей и управление правами доступа.

## Основные роли

- **Admin**:
  - Создание нарко-диспансеров, комнат и коек.
  - Управление правами доступа пользователей.
  - Все функции главного врача.

- **Главный врач**:
  - Заселение пациентов (Check-in).
  - Выписка пациентов (Check-out).
  - Генерация справок для пациентов.

## Технологии

Проект использует следующие технологии и библиотеки:
- **FastAPI**: для создания веб-приложения.
- **asyncpg**: для взаимодействия с базой данных PostgreSQL.
- **SQLAlchemy**: программная библиотека для работы с реляционными СУБД
- **Alembic**: для управления миграциями базы данных.
- **Pydantic**: для проверки данных.
- **APScheduler**: для планирования задач, включая генерацию PDF документов.
- **Pytest**: для тестирования функциональности.
- **Uvicorn**: для запуска и обслуживания приложения.
- **Docker**: для развертывания проекта.
- **Redis**: для повышения производительности.
- **JWT**: для аутентификации и авторизации.
- **Ruff**: для анализа кода и линтинга.

## Установка

1. **Клонируйте репозиторий:**

    ```sh
    git clone https://github.com/abduqodir2287/MedRegistry.git
    cd MedRegistry
    ```

2. **Создайте и активируйте виртуальное окружение:**

    ```sh
    python -m venv venv
    source venv/bin/activate  # Для Windows используйте `venv\Scripts\activate`
    ```

3. **Установите зависимости:**

    ```sh
    pip install -r requirements.txt
    ```

4. **Настройте переменные окружения:**

   Вам необходимо скопировать файл `env_example` в `.env` и заполнить его своими данными.

   ```sh
   cp .env_example .env


5. **Настройте Alembic для миграции:**

    ```sh
   make alembic-upg
   
6. **Если у вас нету make:**
    ```sh
   python -m alembic upgrade head
    
   
## Использование

1. **Запустите приложение:**

   ```bash
   make start-service
    ```
2. **Если у вас нету make:**
    ```bash
    uvicorn src.main:app --reload --port 8000
    ```

## Откройте в браузере `http://127.0.0.1:8000/docs` для доступа к документации API.


## Автоматическое создание суперпользователя и диспансера

При первом запуске приложения автоматически создаются следующие данные:

### 1. Диспансер

- **Название:** Medion Innovation
- **Адрес:** Abdulla Qodiriy 39/1

### 2. Суперпользователь

- **Имя:** admin
- **Фамилия:** adminov
- **Пароль:** password
- **Роль:** superadmin
- **Должность:** superadmin
- **ID диспансера:** 1

Эти данные создаются для упрощения начальной настройки приложения. Если вам нужно изменить эти данные, вы можете сделать это непосредственно в базе данных после первого запуска приложения.


## Использование API:

### Основной эндпоинт:
- **GET http://127.0.0.1:8000/Users/1**
- **Пример ответа:**
    ```json
  {
      "id": 1,
      "firstname": "admin",
      "lastname": "adminov",
      "job_title": "superadmin",
      "role": "superadmin",
      "dispensary_id": 1
  }
  ```

- **В случае несуществующего пользователя:**
    ```json
    {
      "detail": "User not found"
    }
    ```

## Тестирование:

Для запуска тестов используйте команду:
```bash
python -m pytest 
```
## Или

```bash
make test 
```
## Если у вас есть make
__________________________________________________________________
